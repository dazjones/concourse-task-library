#!/bin/bash -xeu

# shellcheck disabled=SC1091
source cf-deployment-concourse-tasks/shared-functions

function main() {
    setup_bosh_env_vars
    bosh_interpolate

    cd concourse-tasks/cloud-sql-setup/terraform/
    terraform init
    terraform apply cloudsql.tf --auto-approve --state="env-repo/${BBL_STATE_DIR}"
}

trap close_bbl_ssh_connection_and_commit_vars_store EXIT

main
